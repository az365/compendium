# Аналитика данных
## Intro
- Что такое Дата-аналитика
    - извлечение знаний из данных
    - исследования и расследования 
    - разовые задачи/вопросы
    - итеративные задачи с заранее неизвестным результатом 
    - нестандартные, некорректные, неполные, нечёткие задачи
    - подкрепление/замена экспертного мнения измеримыми фактами
    - поддержка принятия решений на данных (продуктовых, бизнесовых, управленческих)
- Чем занимаются аналитики данных и как начать? https://academy.yandex.ru/posts/chem-zanimayutsya-analitiki-dannykh-i-kak-nachat-rabotat-v-etoy-oblasti
## Аналитические задачи
- особенность аналитическхи задач: нестандартность, некорректность, неполнота, ...
- типы задач 
    - как это устроено?
    - А или Б?
    - что произошло?
- аналитика в продукте
    - создание продукта - аналитика для продуктовых требований 
        - изучение данных
        - изучение аудитории
        - изучение структуры спроса
        - изучение типовых сценариев
        - разработка KPI и метрик
    - запуск продукта - аналитика запуска/внедрений
        - проведение эксперимента
        - анализ KPI 
        - анализ отклонений реальной аудитории и сценариев от заложенных 
    - поддержка продукта
        - мониторинг 
        - оценка качества
        - расследование проблем
        - исследование живой аудитории
        - новая функциональность => новый виток (создание продукта)
## Аспекты
- источники данных
    - состав работ 
        - поиск источников и получение данных
        - понимание природы источников
        - чистка и формализация данных
    - происхождение источников
        - внутренняя статистика
        - внешняя публичная статистика
        - целевой сбор
        - закупка
    - параметры источников
        - точность: чему можно верить а чему нет
        - состав: соцдем, география, интересы, активность, ...
        - детальность
        - дискретность, регулярность: каждые 5 минут, день, месяц, квартал
        - полнота: иногда видим нерепрезентативную часть активности
        - перекосы: чем выборка отличается от генеральной совокупности
        - гибкость: например, возможность пересекать множества
        - шумность
        - скорость: ответ за 5 секунд или 3 недели
        - цена
    - некоторые виды источников 
        - информационные/транзакционные системы
        - логи сервисов, приложений, внешних счётчиков
        - панельные данные - когда 1 объект трекается очень долго (не куки, не случайные опросы)
        - парсинг внешних сайтов
- проведение исследования 
    - выявление структуры
    - построение гипотез
    - проверка гипотез 
    - построение выводов на данных
- презентация результатов
    - говорить на понятном языке
    - отвечать на волнующие вопросы
    - объективная картина (факты)
    - субъективная картина (storytelling) http://www.unece.org/fileadmin/DAM/stats/documents/writing/MDM_Part1_English.pdf
    - визуализация https://github.com/az365/compendium/blob/master/disciplines/datavis.md
    - приятные бонусы
## Workflows and frameworks
- базовая последовательность (может итерироваться)
    - ознакомление, визуализация
    - формирование гипотез, построение моделей
    - прототипирование расчётов
    - интерпретация модели и результатов
- от проблемы до публикации
    - бизнес-проблема
    - синопис / что известно 
    - формулировка гипотез/вопросов/подходов 
    - EDA, поиск сигнала 
    - отчёт 
    - деш/инструмент
    - мониторинг
    - преза 
    - внешнеяя публикация
- Reproducible Research
    - John Hopkins University - Reproducible Research cource https://www.coursera.org/learn/reproducible-research
- Lean analytics 
    - cycle: ideas->build->product->measure->data->learn->ideas->...
    - lean canvas: problem, customer segments, unique value proposition, solution, channels, revenue streams, cost structure, metrics, unfair advantage
    - lean analytics cycle (the cycle of life for analytical startups)
- HADI canvas 
    - HADI-циклы в развитии компании http://artbayard.ru/hadi
    - HADI: 5 лайфхаков для проверки гипотез https://www.iidf.ru/media/articles/lifehacks/hadi-tsikly-5-layfkhakov/
- CRISP-DM
    - этапы согласно wikipedia.org/wiki/CRISP-DM
        - business understanding
        - data understanding
        - data preparation
        - modeling
        - evaluation
        - deployment
    - этапы согласно habr.com/ru/company/ods/blog/430006
        - формулировка задачи
        - методы решения и данные
            - исследуем возможные подходы к её решению и сформулируем требования к данным
            - соберём необходимые данные
        - exploratory research / eda - exploratory data analysis - изучим собранный датасетт
        - feature engineering - извлечём признаки из сырых данных
        - обучим модель
        - model evaluation - сравним полученные результаты, оценим качество полученных решений и при необходимости повторим пункты 2-6
        - deployment to production - упакуем решение в сервис, который можно будет использовать
## Метрики
- https://github.com/az365/compendium/blob/master/disciplines/metrics.md
- классификации метрик 
    - из Lean Analytics http://leananalyticsbook.com/
        - qualitative vs quantitative
        - vanity vs actionable (8 vanity m: hits, pageviews, visits, visitors, followers/likes, time on, emails collected, downloads)
        - exploratory vs reporting metrics (the hidded genius of Donald Rumsfeld)
        - accounting (how close you are to an ideal) vs experimental (help to optimize the product, pricing, market)
        - leading vs lagging
        - correlated vs causal
    - по способу сопоставления
        - мониторинг и KPI 
            - измеримость
            - достижимость
            - объективность
            - понятный физический смысл
            - понятное влияние на цели компании
            - понятно, как влиять на этот kpi
        - приёмочные (АБТ)
            - красить ухудшения (благодаря монтонности прокрасят и улучшения)
            - не красить контроли (АА-тест)
            - чувствительность (красить лучше других)
            - применимость (некоторые метрики не совместимы с некоторыми типами экспериментов)
    - по близости к прикладным целям продукта
        - оффлайн: оценка качества модели (на тест-сетах)
            - оффлайновая метрика строится на модели продукта и пользователя и приближает онлайновую, но считается дешевле и без рисков на живой аудитории
        - онлайн: измеримые пользовательские (на АБТ)
        - абстрактные: счастье пользователя (то, что в идеале хотим померить, но не можем)
    - по назначению
        - бизнесовые: оцифровка бизнес-модели 
        - аудиторные: MAU, DAU, Core, Churn/Retention, LT, LTV
            - про ретеншены и LifeTime: http://kxk.ru/matriarhat/v1_693889__.php
            - параметры сессионного LT/LTV: timeout, timebound
        - поведенческие: как пользуются продуктом 
            - сессионные (session-based)
            - секвенциальные (CJM-based)
        - оценочные: что такое счастье (измерения качества продукта)
- хорошие и плохие 
    - хорошая метрика согласно Lean Analytics http://leananalyticsbook.com/
        - comparative
        - understandable
        - ratio or rate (ratios are easier to act on, are inherently comparative, are good for comparing factors)
        - changes the way to behave
- культура работы с метриками
    - верифицируемость
        - всегда ссылаться на источник с подробностями 
        - коммитить отчуждаемый код расчёта метрик 
        - формулировать воспроизводимо 
    - верифицированность 
        - сбиваться с эталонными расчётами 
        - можем объяснить, что и почему видим 
        - можно умножать/делить на показатели из других каноничных источников
    - как визуализировать https://github.com/az365/compendium/blob/master/disciplines/datavis.md
        - рисовать больше одного числа на кртинке
        - всегда указывать полное наименование среза и метрики на картинке (аббревиатуры и жаргонизмы можно)
        - аккуратность и стандартизация форматов определяют скорость и однозначность чтения
        - стандартизированные обозначеня (цвета, штриховки, шрифты)
        - растры по-английски 
    - как анализировать 
        - выписать, что отображено 
        - выпивать, что тут видно (по факту)
        - гипотезы и трактовки
        - выписывать допущения и ограничения 
    - как расследовать 
        - формулировать увиденную аномалию KPI
        - симптомы: локализация до среза, сопутствующие факты со ссылками
        - гипотезы и проверки 
    - как доносить/формулировать 
        - показывать степень уверенности (показывается вводными оборотами)
            - фактическое наблюдение (видим, что)
            - доказанный факт (показано, что)
            - сильная гипотеза (кажется, что)
            - авторитетное утверждение (утверждается, что)
            - собственное мнение (на мой взгляд)
            - слабая гипотеза (может быть)
            - фантазия (а вдруг, вот бы)
        - разделять корреляции и причины-следствия
        - убедиться, что правильно поняли 
        - проследить, как использовано (попросить согласовать решение/публикации)
- разработка системы метрик 
    - иерархия метрик
        - нижележащие метрики либо аппроксимируют, либо детализируют вышележащие
        - аппроксимации всегда неточны и в случае метрик эта погрешность неизмерима
        - всегда остаются белые пятна, которые надо заполянть волей и виженом 
    - от структуры метрик к структуре организации
        - каждый человек/подразделение должны знать, какую метрику они растят, и как она влияет на вешележащие по иерархии
    - техническая подложка: согласованность ключевых данных и показателей + стыкуемость инструментов
        - онтология (бизнес-глоссарий)
            - общие понятия в команде 
            - переиспользуемость и сопоставимость расчётов 
            - техническая реализация и применение 
        - кубы (витрины)
        - сетка vs вертикали
        - велосипеды vs компоненты/микросервисы
        - плоские vs сессионные таблицы 
        - материализации vs библиотеки/вьюхи/апи/api 
- анализ и поддержка метрик
    - качество данных, стоимость поддержки, скорость разработки
        - под каждым KPI должен быть куб, позволяющий распилить его на компоненты
        - KPI-метрика должна быть зрелой, чторбы иметь доверие, быть экшенабельной и интерпретабельной
    - бизнес/продакшен: мониторинг и расследования
        - аномалия как (бес)полезный сигнал
        - точки измерения
        - цепочки для локализации измерений
        - чеклисты
        - WTF-framework
- литература
    - О.Якубенков - Интро: Метрики (2013) https://gopractice.ru/metrics1/
    - О.Якубенков - Продуктовая и аналитическая культура Facebook https://gopractice.ru/fb-product-culture/
## Data Architecture for Business 
- https://www.youtube.com/watch?v=ArzohefZLE4
- The data science hierarchy of needs (pyramide)
    - AI, DL
    - Learn/optimize: ABT, experimentations, simple ML algorythms
    - Aggregate/label: Analytics, metrics, segments, aggregates, features, training data
    - Explore/transform: Cleaning, anomaly detection, prep
    - Move/store: Reliable data flow, infrastructure, pipelines, ETL, structured and unstructured data storage
    - Collect: instrumentation, logging, sensors, exteral data, UGC
- Timeline
    - Start of a product
    - Looking for a weekly reports and a KPI dashboard
    - Anomaly detection to see issues right away
    - Want to make decisions based on information
    - Want a platform for a forensic analytics to speed up product development
    - ...
    - You are road-blocked by your current setup and looking for new opportunities/improvements
    - Recognize you want to use your data more excessively
    - Transition into a data-driven company
- Data collection
    - Onwnership and access of data
    - Near-real time raw data
    - No data sampling
    - Personal identification Information
    - Data model
    - SDKs with persistent layer
## некоторые распространённые инструменты
- Rapid Miner
- sas
- ibm spss
    - см есть ли про него в толстой красной книге
## Области и методы
- Timeseries
    - лекция Технострим: Временные ряды (Введение в анализ данных) https://www.youtube.com/watch?v=Qflkzc6Ep78&list=PLrCZzMib1e9p6lpNv-yt6uvHGyBxQncEh&index=8
    - Data Mining in Action 10: Прогнозирование временных рядов https://www.youtube.com/watch?v=u433nrxdf5k
    - ML Course: анализ временных рядов https://habr.com/ru/company/ods/blog/327242/ https://www.youtube.com/watch?v=nQjul-5_0_M
        - rolling window estimations
        - экспоненциальное сглаживание, модель Хольта-Винтерса
        - кросс-валидация, подбор параметров
        - эконометрический подход
        - избавляемся от нестационарности, строим SARIMA
        - feature-based модели на временнЫх рядах
            - линейная регрессия 
            - XGBoost на временнЫх рядах
    - популярные методы и библиотеки
        - Prophet https://habr.com/ru/company/ods/blog/323730/
        - ARIMA https://en.wikipedia.org/wiki/Autoregressive_integrated_moving_average
        - ARCH https://en.wikipedia.org/wiki/Autoregressive_conditional_heteroskedasticity
    - приведение к нормальному распределению
        - преобразование бокса-кокса http://www.machinelearning.ru/wiki/index.php?title=%D0%9C%D0%B5%D1%82%D0%BE%D0%B4_%D0%91%D0%BE%D0%BA%D1%81%D0%B0-%D0%9A%D0%BE%D0%BA%D1%81%D0%B0
- Cohort analysis
    - Churn/Retention
    - LT, LTV 
    - RFM 
    - литература
        - О.Якубенков - Когортный анализ (2014) https://gopractice.ru/cohort_analysis/
        - О.Якубенков - Длинный и короткий ретеншен (2020) https://gopractice.ru/why-long-term-retention-is-key-to-growth/
        - В.Голубев - Оценка LifeTime через ретеншен (2010): http://kxk.ru/matriarhat/v1_693889__.php
- Segmentation
    - поиск контраста по срезам
        - перебор срезов или попарных сочетаний
        - кутим круб в BI (или в pandas)
    - кластеризация
    - метрики контраста сегментов
        - перекос = (A-B) / (A+B)
        - аффинити, аффинитивность
        - потенциалы сегментов
    - литература
        - Олег Якубенков - Сегментация (2014) https://gopractice.ru/segmentation/
- Causal inference
    - AB-testig
        - основы 
            - литература 
                - Я.Академия, Lisa Xu: Как провести АБТ, 6 простых шагов (2019) https://academy.yandex.ru/posts/kak-provesti-a-b-testirovanie-6-prostykh-shagov
                - Яндекс @ Habr: Как у нас устроено АБТ (2017) https://habr.com/ru/company/yandex/blog/342704
                - Uber Experimentation Platform (2018) https://eng.uber.com/xp
                - Bing: Five Puzzling Outcomes Explained (2012): http://www.exp-platform.com/Documents/puzzlingOutcomesInControlledExperiments.pdf
                - AdOneTech @ Habr: 70 ресурсов про АБТ для начинающих (2014) https://habr.com/ru/post/242701
        - выбор приёмочных метрик
            - процесс
                - поиск коррелирующих с бизнес-метрикой и/или текущей приёмочной
                - валидации метрик на эталонных экспериментах 
                - проверка на АА-тестах
            - критерии выбора приёмочных АБТ-метрик
                - красить ухудшения (благодаря монтонности прокрасят и улучшения)
                - не красить контроли (АА-тест)
                - чувствительность (красить лучше других)
                - применимость (некоторые метрики не совместимы с некоторыми типами экспериментов)
        - АБ-тесты на малых выборках 
            - МТС: АБТ на регионах (2020) https://youtu.be/e9kSPMjpLL8
                - https://engineering.nordeus.com/
                - https://www.tripadvisor.com/engineering/reducing-a-b-test-measurement-variance-by-30/
                - https://booking.ai/how-booking-com-increases-the-power-of-online-experiments-with-cuped-995d186fff1d
        - проблемы и решения 
            - некорректный эксперимент 
                - пересмотреть методику и реализацию, перепровести
            - потребовался релиз до эксперимента
                - провести разовый обратный эксперимент
            - шумные метрики, ничего не красится 
                - увеличение выборок и продолжительности
                - методы на малых выборках (см. выше про  АБТ на регионах)
                - методы понижения дисперсии 
                - поиск чувствительных прокси-метрик (см. про приёмочные метрики выше)
                - последовательные внедрения с оффлайн-приёмкой + постоянный/долгий обратный эксперимент
            - превратить приёмочную метрику в KPI
                - постоянный обратный эксперимент (или долгие разовые)
            - много гипотез/версий/объектов для тестирования
                - многомерные параллельные тесты + Multivariate analysis
                - однорукие бандиты - для автоматического опробования большого числа гипотез/объектов-кандидатов
            - сложно задизайнить или дорого провести эксперимент 
                - Observational studies на исторических данных (подробно см. ниже)
    - Observational studies
        - применение 
            - может проводиться до АБ-тестинга - для формирования или первичной проверки гипотез
            - может рассматриваться как альтернативап АБ-тестингу, когда он затруднён 
        - AB-testing vs Observational Studies
            - АБ-тест
                - иногда проблематично задизайнить или дорого провести
            - Observational studies
                - корреляции не означают причинно-следственной связи
                - мешают неизвестные/неизмеренные зависимости
        - препятствия
            - conditioned cofounding (общая причина, пример: лекарство тяжело больным)
            - selection bias (общее следствие, пример: фолиевая кислота беременным)
            - complicated bias with conditioning (зафиксированный фактор, пример: зожники vs больные раком)
        - подходы
            - stratification (перевзвешивание страт/сегментов в зааффекченной выборке на их доли в генеральной совокупности)
            - propensity scores (перевзвешивание групп на вероятность воздействия на объект)
            - outcome regression (проблема: могут просочиться фичи с результатами воздействия)
            - тесты причинности
                - Granger causality test https://ru.wikipedia.org/wiki/Причинность_по_Грэнджеру
                - g-метод https://www.ncbi.nlm.nih.gov/pmc/articles/PMC6074945/
        - литература
            - видео доклада Causal Inference: Если бы да кабы (2020) https://youtu.be/V4ONp9PZrvk
            - KDD-tutorial - Causal Inference and Counterfactual Reasoning (2018) https://causalinference.gitlab.io/kdd-tutorial/intro.html
            - книга M.Hernan - Causal Inference (2020) https://www.hsph.harvard.edu/miguel-hernan/causal-inference-book
            - статья A.Naimi - An introduction to g methods (2017) https://www.ncbi.nlm.nih.gov/pmc/articles/PMC6074945
            - обзор J.Pearl - Causal inference in statistics (2009) http://ftp.cs.ucla.edu/pub/stat_ser/r350.pdf
            - видео доклада P.Tennant - https://www.youtube.com/watch?v=SbrX3YEMj_0
            - видео+код A.Sharma - Causal Inference in Online Systems (2016) https://github.com/amit-sharma/causal-inference-tutorial
    - Simple modeling
        - Causal Impact python library
    - Counterfactual learning
        - Causal inference, counterfactual frameworks https://causalinference.gitlab.io/kdd-tutorial/intro.html
        - Large-scale Validation of CounterfactualLearning Methods: A Test-Bed http://www.cs.cornell.edu/~adith/Criteo/NIPS16_Benchmark.pdf
- Анализ графов
- Spatial / Геоаналитика
    - конспект лекций про spatial analysis: http://www.seas.upenn.edu/~ese502/#notebook
    - Spatial Data Science and Applications https://www.coursera.org/lecture/spatial-data-science/spatial-data-analysis-zT39o
    - пример задачи: выбор точек для открытия магазинов
        - https://new-retail.ru/persony/bst_organika_kak_uspeshno_upravlyat_otkrytiyami_nayti_luchshie_mesta_i_postroit_optimalnuyu_set_torg1113
## Роли, специальности, скиллы, процесс и культура
- Виды аналитиков 
    - BI-аналитик 
    - дата-аналитик 
    - бизнес-аналитик
    - системный аналитик 
- Смежные специальности (аналитик частично совмещает такие роли)
    - аналитик-разработчик
    - дата-инженер 
    - data scientist 
    - ml-инженер 
- А.Натёкин (ODS): Чем отличаются DA, DE, DS (2018) https://www.youtube.com/watch?v=lDkTNURDIaY
- Требования к дата-аналитикам
    - собственно аналитический скилл
        - стремление докопаться до причины явления, понять смысл
        - критическое мышление, способность и стремление оспаривать собственные гипотезы и сомневаться во всём
        - способность видеть или находить все возможные: взаимосвязи, причины, пути
        - умение декомпозировать сложную аналитическую задачу на ряд более простых
        - развитая логика
    - математические скиллы https://github.com/az365/compendium/blob/master/disciplines/math.md
        - тервер, матстат
        - линейная алгебра
        - дискретная математика
        - численные методы
    - технические скиллы
        - алгоритмы и структуры данных https://github.com/az365/compendium/blob/master/disciplines/algo.md
        - визуализация данных https://github.com/az365/compendium/blob/master/disciplines/datavis.md
- Процесс и культура
    - Understand, Identify, Execute 
        - Продуктовая культура Facebook: Understand, Identify, Execute https://gopractice.ru/fb-product-culture/
## Ошибки и заблуждения
- Топ10 ошибок и заблуждений - согласно Monica Rogati, a data scientist at LinkedIn
    - Assuming data is clean.
    - Not normalizing (пример: искали, где больше выездных свадеб, нашли крупные аэропорты)
    - Excluding outliers.
    - Including outliers.
    - Ignoring seasonality.
    - Ignoring size when reporting growth.
    - Data vomit (плохие деши)
    - Metrics that cry wolf (ложные алерты ведут к слепоте)
    - The 'Not Collected Here' syndrome (неприятие внешних данных ведёт к упущению возможностей по обогащению своих)
    - Focusing on noise
- согласно Евгению Завьялову (Технострим Mail.ru) https://www.youtube.com/watch?v=uZ-l13XzejA&list=PLrCZzMib1e9p5F99rIOzugNgQP5KHHfK8
    - (не)нормальное распределение 
    - выбросы в данных
- мифы о метриках
    - метрики нужны только для отчётности руководству 
    - посчитать одну правильную цифру проще, чем много цифр 
    - можно принимать все решения только на метриках 
    - твоя работа всегда должна влиять на какую-то метрику 
    - есть ложь, есть наглая ложь, есть статистика 
## Литература, курсы, ссылки
- курсы 
    - Технострим - Введение в анализ данных (2019) https://www.youtube.com/watch?v=5Yl6_2d0CN0&list=PLrCZzMib1e9p6lpNv-yt6uvHGyBxQncEh
        - Анализ данных - процесс исследования, фильтрации, преобразования и моделирования данных с целью извлечения полезной информации и приняия решений
        - специалисты по анализу данных
            - bi-аналитик - решает срочные задачи, работает с БД, готовит дешборды, отвечает за визуализацю 
            - аналитик - знает предметную область, анализирует метрики, проводит эксперименты, составляет прогнозы, закапывается в данные
            - data scientist - структурирует и анализирует большие объёмы данных, применяет машинное обучение для предсказания событий и обнаружения неочевидных закономерностей
        - рекомендуемые книги по python 
            - Learning Python (O'Reilly)
            - Python for Data Analysis 
    - Технострим - Введение в анализ данных (2016) https://www.youtube.com/playlist?list=PLrCZzMib1e9p5F99rIOzugNgQP5KHHfK8
- книги 
    - Alistair Croll - Lean Analytics, Lean UX, Lean Startup http://leananalyticsbook.com https://gopractice.ru/lean_analytics/
    - Аналитическая культура (O'Reilly)
    - Билл Фрэнкс - Революция в Аналитике 
    - ...
- блоги
    - Олег Якубенков http://gopractice.ru
- примеры данных для тренировки
    - Примеры датасетов для Clickhouse https://clickhouse.tech/docs/ru/getting-started/example-datasets
    - Kaggle datasets https://www.kaggle.com/datasets