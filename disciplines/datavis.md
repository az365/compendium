# Data Visualisation
## Зачем визуализировать 
- кейсы    
    - сравнить разные показатели
    - проследить взаимосвязь между показателями
    - показать распределение данных, например, какие показатели встречаются чаще, а какие реже
    - показать структуру чего-либо с помощью данных
- применения
    - презентации
        - лаконично
        - заточено под тезис 
        - однозначно интерпретируется 
    - отчёты (формальная отчётность)
        - как презентации, но можно подробнее 
        - упор на общепринятые стандартизированные показатели 
        - заранее знаем межеры и дименшены 
        - важны цифры, визуализация вторично 
    - публикации (дата-журналистика)
        - pr, entertainment, дать пищу для ума 
        - больше повтыкать 
        - интерактивность
        - качество
        - соответствие стайлгайдам 
    - справочник
        - база знаний: аккумуляция, структурирование, эталоны (пример: графики на климатических картах)
        - результаты исследований 
    - eda / исследование
        - расширить картину мира: какое бывает А, из чего состоит, ...
        - найти сигнал: контраст, паттерн, ... дрилл-даун 
        - проверить гипотезы: верно/неверно, одинаковые/разные, красится/серое 
        - сравнить, сделать выбор: А или Б, лучше/хуже, больше/меньше 
        - нагенерить факторов для модели
    - деши, мониторинг втч kpi
        - быстро видеть, что происходит сейчас
        - самое главное: быстро понимать, всё ли идёт как надо или требуется реакция/действия/коррективы 
        - иметь возможность реакции: получить детализацию, зарепортить проблему, ...
        - примеры: дешборд, пульт оператора/диспетчера, стена плача 
        - иметь в быстром доступе детализацию 
- аналитический воркфлоу
    - бизнес-проблема
    - синопис / что известно 
    - формулировка гипотез/вопросов/подходов 
    - eda, поиск сигнала 
    - отчёт 
    - деш/инструмент
    - мониторинг
    - преза 
    - внешнеяя публикация
## что визуализировать
- как готовить данные 
    - кубы/датасеты/витрины 
    - отдельные таблицы для разных классов объектов (на 1 картинке - 1 класс)
    - лучше денормализованные
- 2 вида плоских таблиц
    - таблица объектов
        - 1 строка - 1 объект 
        - топ1 межер - NuberOfRecords
        - когда диеншенов много
        - когда объектов не слишком много
        - можно семплировать
    - таблица срезов
        - 1 строка - 1 точка пересечения дименшенов
        - межеры предагрегированы 
        - когда дименшенов мало 
        - когда объектов много 
        - нельзя семплировать 
- выбор межеров и дименшенов 
    - некоторые поля могут выступать и тем, и тем 
    - дименшены: числовые и категориальные 
    - межеры: аддитивные, неаддитивные
- дообработка перед отрисовкой
    - числовые дименшены
        - бинаризация: получить несколько дискретных категорий из непрерывной псевдослучайной величины
    - категориальные дименшены 
        - сократить число категорий в каждом дименшене до 4+-2
            - иерархии (А: А1, А2, А3; Б: Б1, Б2; ...)
            - топы с other'ами (А, Б, Ц, other)
            - разделить на ортогонтальные (9=3х3, 12=3x4, 16=4x4)
    - межеры
        - нормировки
            - на сумму
            - на эталонный срез
            - на выбранную точку - для сравнения динамики 
                - пример: queue.acm.org/detail.cfm?id=1805128
        - вторичные метрики 
            - неаддитивные из аддитивных получать на этапе отрисовки
                - SpU=S/U
                - mean_price=revenue/count 

## Чем визуализировать
- сравнение популярных инструментов
    - Excel и аналоги
        - чем плох: не продакшен, не расширяемо, не видно ошибок/подгонов
        - чем хорош: всегда под рукой, все умеют, быстро сделать картинку из нескольких цифр, редактабельно
        - примеры: Excel, LibreOffice Calc, Google Sheets, ...
        - литература 
            - prodomosua.eu - добиться от экселя странного
                - Просто эксели http://www.prodomosua.eu/ppage05.html внизу страницы
                - Модули для экселя http://www.prodomosua.eu/ppage02.html вся страница
                    - они под 2007 офис, и не все совместимы с 2010
    - BI - системы self-service аналитики 
        - чем хорош: может прод, легко научиться, быстро нарисовать много дименшенов, удобно шарить 
        - чем плох: надо хорошо готовить данные, не всё можно, не редактабельно
        - какие бывают: PowerBI, Tableau, Qlik
        - сравнение: gartner quadrant http://www.tadviser.ru/images/f/f6/Forrester_Wave_data_visualization_2012.png
        - рекомендую начать с Tableau - помогает привыкнуть с управлению межерами и дименшенами
    - Python и Jupyter 
        - чем хорош: может прод, гибкие преобразования и аггрегации, легко кастомизировать и стандартизировать, много бибиотек 
        - чем плох: требует квалификации, опасность погружения в код
        - библиотеки
            - matplotlib
            - seaborn
            - joinplot
            - plotly/bokeh
            - altair - python-библиотека на Vega-Lite для декларативного описания интерактивных визуализаций
    - JavaScript 
        - чем хорош: можно интерактив, можно встраивать, можно сильно кастомизировать 
        - чем плох: внедрение/поддежка/расширение требует квалификации
        - библиотеки
            - highcharts - используется в дешбордах
            - d3js - лучшие интерактивные визуализации 
            - dc.js Dimensional Charting Javascript Library http://nickqizhu.github.com/dc.js/
            - bokeh js - позволяет рисовать динамические графики для моделей 
    - кастомные решения 
        - чем хорош: мжоно всё, максимально заточить под задачу 
        - чем плох: максимум квалификации, трудоёмко расширять и поддерживать 
    - Illustrator 
        - исползьзуют дата-журналисты
            - сначала делают заготовку в любом из вышеперечисленных инструментов
            - экспортируют в растр
            - доводят в Иллюстраторе
        - чем хорош: аттрактивность, максимальная кастомизабельность
        - чем плох: трудоёмко, маскировка ошибок и подделок 
- топ Kaggle (согласно habr.com/ru/company/ods/blog/434134)
    1 matplotlib
    2 seaborn
    3 ggplot2
    4 plotly
    5 shiny
    6 bokeh
    7 d3js
    8 leaflet
    9 geoplotlib
    11 lattice
    12 altair 
## Как визуализировать 
- из чего состоит визуализация
    - выбор типа диаграммы
        - стандартные
            - пайчарты - piechart
                - для през - показать 1 долю, не сравнивая ни с чем 
                - для финансов - метафора денег, пирога 
                - для вторичных метрик в скаттерплоте
            - бары - barchart
                - важны конкретные цифры (пример: квартальные показатели)
                - сопоставления
                - распределения дискретные или по неравномерным бинам (когда линия не подходит по метафоре)
            - области - stack
                - показать изменение структуры потока (интерактивное лирическое отступление: парадокс симпсона)
                - только для аддитивных срезов и метрик 
                - видна сумма и влияние её составляющих
                - помогает показать изменение структуры потока 
                - интерактивное лирическое отступление: парадокс симпсона
            - линии - line
                - важна форма динамики/распределения (примеры: мониторинг, eda)
                - важны пересечения (примеры: мы vs конкурент, 2 распределения)
                - распределения на равномерной шкале
            - скаттерплот - scatterplot
            - хитмапы - heatmap
            - фигуры: круг, кольцо, квадрат, прямоугольник 
        - специализированные
            - параллел-сетс / weighted-flow-charts / sankey 
                - когда использовать
                    - много дименшенов, 1 аддитивный межер 
                    - когда неочевидная или неточная иерархия 
                - примеры 
                    - как Наполеон шёл на Москву https://dl.acm.org/cms/attachment/8205d858-3366-4cff-9d9c-473e1af819ea/heer_fig3a.png https://queue.acm.org/detail.cfm?id=1805128
                    - энергопотребление UK https://pbs.twimg.com/media/EGmB424W4AE0xL-.jpg https://www.gov.uk/government/statistics/energy-flow-chart-2018
            - графы, укладка, кластеризация (+деревья, +simple-flow-charts)
                - примеры: схема метро, CJM, города и логистика (?)
                - частый частный случай: отображение дерева иерархии (товаров, например)
                    - пример https://dl.acm.org/cms/attachment/7081f85b-d731-41bd-9af6-26c5cde19e91/heer_fig4a.png https://queue.acm.org/detail.cfm?id=1805128 
                    - альтернатива для дерева: прямоугольники с мощностями классов
            - поверхности
                - в 2D и 3D-проекциях
                - хитмап, карты изолиний (триангуляция?), берк-штрихи, потоки 
            - гео 
                - точки, линии, изолинии, потоки 
            - подсветка объектов на фото/видео 
                - примеры
                    - отображение дорожной ситуации в беспилотном автомобиле
                    - системы безопасности промышленных предприятий
            - таймлайны
                - последовательности событий
                - примеры сессий
                - диаграммы ганта
            - кастомная инфографика 
                - примеры
                    - воронки 
                    - специроекты риа-новости и new york times 
    - выбор межеров, дименшенов
        - помещаем межеры/дименшены на канвас 
            - x, y, xx, yy
            - линия: цвет, толщина, начертание
            - точки на линии: форма, размер, цвет контура, цвет заливки
            - фигура: ширина/высота, 
                - круг: диаметр, сектора/поддиаметры 
                - кольцо: внутренний радиус, внешний радиус, сектора/поддиаметры, сдвиги 
            - анимация
            - селекторы
        - особо полезные поля
            - межер NumberOfRecords
            - дименшен MeasureName
        - сколько дименшенов брать в одну картинку
            - сколько нужно 
                - преза - чем меньше, тем лучше
                - EDA - чем больше, тем лучше 
            - сколько комфортно
                - 4, столбцы
                    - дименшены: x, xx, yy, цвет
                    - межер: y 
                    - тип: столбцы
                - 4, линии
                    - дименшены: цвет, толщина, начертание 
                    - межер: y 
                    - тип: линии 
                - 4, хитмап
                    - димешнены: x, y, xx, yy 
                    - межер: цвет 
                    - тип: хитмап 
                - 6, скаттерплот 
                    - дименшены: x, y, xx, yy, цвет, сектора 
                    - межер: размер 
                    - тип: скаттер 
    - нстройка: шкалы, сетка, легенда, подпси 
        - чем меньше - тем лучше 
        - но не выплеснуть с водой ребёнка
        - линии сетки использовать, когда нет места на подписи 
        - тайтл лаконичный но точный (срез, характеристика выборки)
## Как делать хорошо
- зачем визуализировать хорошо
    - оптимизировать под зрительное восприятие людей 
    - легче отсматривать много данных для поиска сигнала и вывода выводов 
    - уверенно принимать решения на данных 
    - вовлекать учасников в процесс анализа и решения 
    - легче шарить полученные знания между собой 
    - красота не ради искусства, а ради эффективности 
- свойства визуального восприятия 
    - узнавать знакомые образы 
    - обращать внимание на контрасты 
    - сравнивать объекты, находить похожие, замечать отличия 
    - менять масштаб: обзор и детализация 
    - улавливать паттерны, повторяющиеся элементы 
    - вертикальное отношение опознаётся надёжнее горизонтального
- как визуализировать хорошо
    - предсказуемо 
        - однотипные графики
            - похожие вещи должны выглядеть похоже
        - стандартные цвета и обозначения
            - не заставлять людей перечитывать каждый раз легенду 
    - аккуратно 
        - выровненные картинки
        - синхронизированные шкалы (масштабы)
        - Туполев: только красивые самолёты хорошо летают
    - минималистично
        - исключить лишнее 
        - но не выплеснуть с водой ребёнка
    - использовать свойства глаза выявлять паттерны
## Как интерпретировать
- описать 
    - интро к исследованию
        - что это и зачем 
        - ограничения и допущения 
        - как получено
            - бд, таблицы, фильтрации
            - ссылка на код   
    - по каждой картинке/группе               
        - что изображено (на конкретной картинке)
        - что видно (непосредственные наблюдения по картинке)
        - что это может означать (гипотезы)
    - выводы, рекомендации
    - что делать дальше 
- если интерпретация не идёт 
    - формально описать полученное 
    - отдохнуть между написанием кода и чтением картинок
    - позвать коллегу посмотреть на картинки вместе 
    - разбить исходную цель на список вопросов/гипотез, ответить по пунктам
    - отрисовать по-другому
- если сегнала не видно
    - побить на (другие) дименшены, детализировать
    - найти/придумать более подходящие метрики 
    - пересмотреть постановку задачи
- если сигнал виден
    - формулировать гипотезы 
        - различать факты, выводы, гипотезы 
        - для краткости можно гипотезы помечать курсивом, уверенные выводы жирным
    - помнить, что корреляция не означает причинно-следственной связи 
        - correlation is not causation 
        - пример: число смертей в водоёмах коррелирует с продажами мороженого 
