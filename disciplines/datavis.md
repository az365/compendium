# Data visualisation
## Литература 
- `site` [eagereyes.org: Visualization and Visual Communication](https://eagereyes.org)
- `site` [Observable: Explore and be inspired with examples](https://observablehq.com/explore)
- `post` [ACM Queue: A Tour through the Visualization Zoo (2010)](https://queue.acm.org/detail.cfm?id=1805128)
- `post` [Диана Сиддикви @ freelance.today - 20 инструментов для визуализации данных](https://freelance.today/poleznoe/20-luchshih-instrumentov-dlya-vizualizacii-dannyh.html)
- `post` [Yagla: 21 инструмент визуализации данных для маркетологов и аналитиков](https://yagla.ru/blog/marketing/21-instrument-vizualizacii-dannyh-dlya-marketologov-i-analitikov/)
- `post` [Barrayar (VK) @ Habr: Другой GitHub: репозитории по Data Science, визуализации данных и глубокому обучению](https://habr.com/ru/company/mailru/blog/437940/)
    - data science
        - The Open-Source Data Science Masters https://github.com/datasciencemasters/go#readme
        - Awesome Data Science https://github.com/academic/awesome-datascience#readme
        - Data science blogs https://github.com/rushter/data-science-blogs#readme
        - LearnDataScience https://github.com/nborwankar/LearnDataScience#readme
        - data-science-ipython-notebooks https://github.com/donnemartin/data-science-ipython-notebooks#readme
    - visualisation 
        - d3.js https://github.com/mbostock/d3 
        - Chart.js https://github.com/chartjs/Chart.js#readme 
        - Echarts https://github.com/apache/incubator-echarts#readme
        - Leaflet https://github.com/Leaflet/Leaflet#readme
        - Sigma.js https://github.com/jacomyal/sigma.js#readme
        - Vega https://github.com/vega/vega#readme
        - DC.js https://github.com/dc-js/dc.js#readme
        - Epoch https://github.com/epochjs/epoch#readme
        - data-science-ipython-notebooks https://github.com/donnemartin/data-science-ipython-notebooks#matplotlib
- `book` Джин Желязны - Говори на языке диаграмм
- `book` Дэн Роэм - Визуальное мышление
- `book` Дэн Роэм - Практика визуального мышления
- `pdf` Как писать истории на данных: [UNECE: Making Data Meaningful. A guide to writing stories about numbers](http://www.unece.org/fileadmin/DAM/stats/documents/writing/MDM_Part1_English.pdf)

## Зачем визуализировать 
- кейсы    
    - сравнить разные показатели
    - проследить взаимосвязь между показателями
    - показать распределение данных, например, какие показатели встречаются чаще, а какие реже
    - показать структуру чего-либо с помощью данных
- применения
    - презентации
        - лаконично
        - заточено под тезис 
        - однозначно интерпретируется 
        - ссылки
            - 11 правил https://habr.com/ru/company/netologyru/blog/341364/
            - 5 трендов 2017 https://l-a-b-a.com/blog/show/100
            - Правила, приёмы, инструменты https://www.owox.ru/blog/articles/data-visualization/
    - отчёты (формальная отчётность)
        - как презентации, но можно подробнее 
        - упор на общепринятые стандартизированные показатели 
        - заранее знаем межеры и дименшены 
        - важны цифры, визуализация вторично 
    - публикации (дата-журналистика)
        - pr, entertainment, дать пищу для ума 
        - больше повтыкать 
        - интерактивность
        - качество
        - соответствие стайлгайдам 
    - база знаний, справочники
        - результаты исследований 
        - аккумуляция, структурирование, эталоны
        - пример: графики на климатических картах
    - eda / исследование
        - расширить картину мира: какое бывает А, из чего состоит, ...
        - найти сигнал: контраст, паттерн, ... дрилл-даун 
        - проверить гипотезы: верно/неверно, одинаковые/разные, красится/серое 
        - сравнить, сделать выбор: А или Б, лучше/хуже, больше/меньше 
        - нагенерить факторов для модели
    - деши, мониторинг втч kpi
        - быстро видеть, что происходит сейчас
        - самое главное: быстро понимать, всё ли идёт как надо или требуется реакция/действия/коррективы 
        - иметь возможность реакции: получить детализацию, зарепортить проблему, ...
        - примеры: дешборд, пульт оператора/диспетчера, стена плача 
        - иметь в быстром доступе детализацию 
- аналитический воркфлоу
    - бизнес-проблема
    - синопис / что известно 
    - формулировка гипотез/вопросов/подходов 
    - eda, поиск сигнала 
    - отчёт 
    - деш/инструмент
    - мониторинг
    - преза 
    - внешнеяя публикация
<a name="content"></a>
## Что визуализировать
- как готовить данные 
    - кубы/датасеты/витрины 
    - отдельные таблицы для разных классов объектов (на 1 картинке - 1 класс)
    - лучше денормализованные
- 2 вида плоских таблиц
    - таблица объектов
        - 1 строка - 1 объект 
        - топ1 межер - NuberOfRecords
        - когда диеншенов много
        - когда объектов не слишком много
        - можно семплировать
    - таблица срезов
        - 1 строка - 1 точка пересечения дименшенов
        - межеры предагрегированы 
        - когда дименшенов мало 
        - когда объектов много 
        - нельзя семплировать 
- выбор межеров и дименшенов 
    - некоторые поля могут выступать и тем, и тем 
    - дименшены: числовые и категориальные 
    - межеры: аддитивные, неаддитивные
- дообработка перед отрисовкой
    - числовые дименшены
        - бинаризация: получить несколько дискретных категорий из непрерывной псевдослучайной величины
    - категориальные дименшены 
        - сократить число категорий в каждом дименшене до 4+-2
            - иерархии (А: А1, А2, А3; Б: Б1, Б2; ...)
            - топы с other'ами (А, Б, Ц, other)
            - разделить на ортогонтальные (9=3х3, 12=3x4, 16=4x4)
    - межеры
        - нормировки
            - на сумму
            - на эталонный срез
            - на выбранную точку - для сравнения динамики 
                - пример: queue.acm.org/detail.cfm?id=1805128
        - вторичные метрики 
            - неаддитивные из аддитивных получать на этапе отрисовки
                - SpU=S/U
                - mean_price=revenue/count 
<a name="instruments">
## Чем визуализировать
- популярные инструменты
    - Электронные таблицы
        - какие: Excel, LibreOffice Calc, Google Sheets, ...
        - чем плох: не продакшен, не расширяемо, не видно ошибок/подгонов 
        - чем хорош: всегда под рукой, все умеют, быстро сделать картинку из нескольких цифр, редактабельно
        - ссылки
            - prodomosua.eu - добиться от экселя странного
                - Просто эксели http://www.prodomosua.eu/ppage05.html внизу страницы
                - Модули для экселя http://www.prodomosua.eu/ppage02.html вся страница
                    - они под 2007 офис, и не все совместимы с 2010
    - [BI](./datan.md#bi) для self-service аналитики 
        - чем хорош: может прод, легко научиться, быстро нарисовать много дименшенов, удобно шарить 
        - чем плох: надо хорошо готовить данные, не всё можно, не редактабельно
        - какие бывают: PowerBI, Tableau, Qlik
        - сравнение: gartner quadrant http://www.tadviser.ru/images/f/f6/Forrester_Wave_data_visualization_2012.png
        - рекомендую начать с Tableau - помогает привыкнуть с управлению межерами и дименшенами
          - `video` [Под капотом Tableau](https://www.youtube.com/watch?v=WU8vSVBB7O4)
              - VizQL - технология преобразования визуальных пилюль в SQL-код, запатентованная Tableau 
              - литература 
                  - Tableau Underhood by Roman Bunin https://public.tableau.com/app/profile/roman4734/viz/TableauUnderhood/VizQL 
                  - Где учить основы по дизайну https://revealthedata.com/blog/all/navyki-dlya-vizualizacii-dannyh-i-dataviz-inzhenerov/ 
                  - Матрица компетенций BI-аналитика https://t.me/revealthedata/601
    - Python и Jupyter 
        - чем хорош: python можно в прод, гибкие преобразования и аггрегации, легко кастомизировать и стандартизировать, много бибиотек 
        - чем плох: погружения в код
        - библиотеки
            - Matplotlib https://matplotlib.org/gallery/index.html
                - 50 оттенков matplotlib — The Master Plots (с полным кодом на Python) https://habr.com/ru/post/468295/
            - Seaborn https://seaborn.pydata.org
            - Plotly https://plot.ly/python/
            - Bokeh https://github.com/bokeh/bokeh
            - ggplot http://ggplot.yhathq.com/
            - Graph visualization with NetworkX https://networkx.github.io/
            - GeoPlotLib https://github.com/andrea-cuttone/geoplotlib
            - Altair - python-библиотека на Vega-Lite для декларативного описания интерактивных визуализаций
        - см также
            - [Biclustering](./ds.md#clustering) algorithms for sorting corrplots https://scikit-learn.org/stable/auto_examples/bicluster/plot_spectral_biclustering.html
    - JavaScript 
        - чем хорош: можно интерактив, можно встраивать, можно сильно кастомизировать 
        - чем плох: внедрение/поддежка/расширение требует квалификации
        - библиотеки
            - highcharts - используется в дешбордах
            - d3js - Data-Driven Documents - лучшие интерактивные визуализации 
                - official http://d3js.org
                - Введение в d3js habr.com/ru/company/datalaboratory/blog/217905
            - dc.js Dimensional Charting Javascript Library http://nickqizhu.github.com/dc.js/
            - bokeh js - позволяет рисовать динамические графики для моделей 
    - кастомные решения 
        - чем хорош: мжоно всё, максимально заточить под задачу 
        - чем плох: максимум квалификации, трудоёмко расширять и поддерживать 
    - Illustrator 
        - исползьзуют дата-журналисты
            - сначала делают заготовку в любом из вышеперечисленных инструментов
            - экспортируют в растр
            - доводят в Иллюстраторе
        - чем хорош: аттрактивность, максимальная кастомизабельность
        - чем плох: трудоёмко, маскировка ошибок и подделок 
- топ Kaggle (согласно habr.com/ru/company/ods/blog/434134)
    - 1 matplotlib (py)
    - 2 seaborn (py)
    - 3 ggplot2 (r)
    - 4 plotly (py)
    - 5 shiny (r)
    - 6 bokeh (js)
    - 7 d3js (js)
    - 8 leaflet (js)
    - 9 geoplotlib (py)
    - 11 lattice (r)
    - 12 altair (py)
## Как визуализировать 
- выбор типа диаграммы
    - стандартные
        - пайчарты - piechart
            - для през - показать 1 долю, не сравнивая ни с чем 
            - для финансов - метафора денег, пирога 
            - для вторичных метрик в скаттерплоте
        - бары - barchart
            - важны конкретные цифры (пример: квартальные показатели)
            - сопоставления
            - распределения дискретные или по неравномерным бинам (когда линия не подходит по метафоре)
        - области - stackplot 
            - только для аддитивных срезов и метрик 
            - видна сумма и влияние её составляющих
            - помогает показать изменение структуры потока 
            - интерактивное лирическое отступление: парадокс симпсона
        - линии - line 
            - важна форма динамики/распределения (примеры: мониторинг, eda)
            - важны пересечения (примеры: мы vs конкурент, 2 распределения)
            - распределения на равномерной шкале
        - скаттерплот - scatterplot
            - пример: Scatterplot Matrix of Automobile Data https://queue.acm.org/detail.cfm?id=1805128 -> https://homes.cs.washington.edu/~jheer//files/zoo/ex/stats/splom.html
            - больше примеров: 50 оттенков matplotlib — The Master Plots https://habr.com/ru/post/468295/
        - хитмапы - heatmap
        - фигуры: круг, кольцо, квадрат, прямоугольник 
    - специализированные
        - параллел-сетс / weighted-flow-charts / sankey 
            - когда использовать
                - много дименшенов, 1 аддитивный межер 
                - когда неочевидная или неточная иерархия 
            - примеры 
                - ParallelSets https://eagereyes.org/parallel-sets
                - как Наполеон шёл на Москву https://dl.acm.org/cms/attachment/8205d858-3366-4cff-9d9c-473e1af819ea/heer_fig3a.png https://queue.acm.org/detail.cfm?id=1805128
                - энергопотребление UK https://pbs.twimg.com/media/EGmB424W4AE0xL-.jpg https://www.gov.uk/government/statistics/energy-flow-chart-2018
        - иерархии
            - много примеров: https://queue.acm.org/detail.cfm?id=1805128
            - частый частный случай: отображение дерева иерархии (товаров, например)
                - пример https://dl.acm.org/cms/attachment/7081f85b-d731-41bd-9af6-26c5cde19e91/heer_fig4a.png https://queue.acm.org/detail.cfm?id=1805128 
                - альтернатива для дерева: прямоугольники с мощностями классов
        - [графы](./math.md#graph), укладка, [кластеризация](./ds.md#clustering) (+деревья, +simple-flow-charts)
            - примеры: 
                - схема метро
                - [кластера](./ds.md#clustering) 
                    - Визуализация больших графов для самых маленьких https://habr.com/ru/company/ods/blog/464715/
                    - Визуализация графа социальной сети: анализ событий блогосферы перед декабрём 2011 года https://habr.com/ru/post/164307/
                    - Алексей Савватеев: Модели интернета и социальных сетей https://habr.com/ru/post/458454/
                - CJM 
                    - https://advenio.es/wp-content/uploads/2015/05/customer-journey-map.png
                - логистика и навигация
                    - граф навигации Карт и Навигатора 
                    - Задачи о кенигсбергских мостах https://urok.1sept.ru/%D1%81%D1%82%D0%B0%D1%82%D1%8C%D0%B8/656970/
                    - Методика формализации междисциплинарных факторов и критериев оптимизации региональных систем экономики https://eee-region.ru/article/5405/
        - поверхности
            - в 2D и 3D-проекциях
            - хитмап, карты изолиний (триангуляция?), берк-штрихи, потоки 
        - гео 
            - точки, линии, изолинии, потоки 
        - подсветка объектов на фото/видео 
            - примеры
                - отображение дорожной ситуации в беспилотном автомобиле
                    - Методы распознавания 3D-объектов для беспилотных автомобилей https://habr.com/ru/company/yandex/blog/437674/
                    - Технологии беспилотных автомобилей. Лекция Яндекса https://habr.com/ru/company/yandex/blog/350414/
                    - Deep Drive BDD100K Dataset https://deepdrive.pl/bdd100k-dataset-pl/
                - трекинг посетителей магазинов по камерам 
                    - Вижу, значит существую: обзор Deep Learning в Computer Vision https://habr.com/ru/company/mipt/blog/458190/
                - системы безопасности промышленных предприятий
        - таймлайны
            - последовательности событий
            - примеры сессий на сайте
            - диаграммы ганта
        - кастомная инфографика 
            - примеры
                - воронки 
                - специроекты риа-новости и new york times 
- выбор межеров, дименшенов
    - помещаем межеры/дименшены на канвас 
        - x, y, xx, yy
        - линия: цвет, толщина, начертание
        - точки на линии: форма, размер, цвет контура, цвет заливки
        - фигура: ширина/высота, 
            - круг: диаметр, сектора/поддиаметры 
            - кольцо: внутренний радиус, внешний радиус, сектора/поддиаметры, сдвиги 
        - анимация
        - селекторы
    - особо полезные поля
        - межер NumberOfRecords
        - дименшен MeasureName
    - сколько дименшенов брать в одну картинку
        - сколько нужно 
            - преза - чем меньше, тем лучше
            - EDA - чем больше, тем лучше 
        - сколько комфортно
            - 4, столбцы
                - дименшены: x, xx, yy, цвет
                - межер: y 
                - тип: столбцы
            - 4, линии
                - дименшены: цвет, толщина, начертание 
                - межер: y 
                - тип: линии 
            - 4, хитмап
                - димешнены: x, y, xx, yy 
                - межер: цвет 
                - тип: хитмап 
            - 6, скаттерплот 
                - дименшены: x, y, xx, yy, цвет, сектора 
                - межер: размер 
                - тип: скаттер 
- нстройка: шкалы, сетка, легенда, подпси 
    - чем меньше - тем лучше 
    - но не выплеснуть с водой ребёнка
    - линии сетки использовать, когда нет места на подписи 
    - тайтл лаконичный но точный (срез, характеристика выборки)
## Как делать хорошо
- зачем визуализировать хорошо
    - оптимизировать под зрительное восприятие людей 
    - легче отсматривать много данных для поиска сигнала и вывода выводов 
    - уверенно принимать решения на данных 
    - вовлекать учасников в процесс анализа и решения 
    - легче шарить полученные знания между собой 
    - красота не ради искусства, а ради эффективности 
- свойства визуального восприятия 
    - узнавать знакомые образы 
    - обращать внимание на контрасты 
    - сравнивать объекты, находить похожие, замечать отличия 
    - менять масштаб: обзор и детализация 
    - улавливать паттерны, повторяющиеся элементы 
    - вертикальное отношение опознаётся надёжнее горизонтального
    - ссылки
        - Моделирование зрения https://habr.com/ru/post/57686
            - 4 Eye tracking и Саккады habr.com/ru/post/57683
- как визуализировать хорошо
    - предсказуемо 
        - однотипные графики: похожие вещи должны выглядеть похоже
        - стандартные цвета и обозначения: не заставлять людей перечитывать каждый раз легенду 
    - аккуратно 
        - выровненные картинки
        - синхронизированные шкалы (масштабы)
        - Туполев: только красивые самолёты хорошо летают
    - минималистично
        - исключить лишнее 
        - но не выплеснуть с водой ребёнка
    - использовать свойства глаза выявлять паттерны
## Как интерпретировать
- описать 
    - интро к исследованию
        - что это и зачем 
        - ограничения и допущения 
        - как получено
            - бд, таблицы, фильтрации
            - ссылка на код   
    - по каждой картинке/группе               
        - что изображено (на конкретной картинке)
        - что видно (непосредственные наблюдения по картинке)
        - что это может означать (гипотезы)
    - выводы, рекомендации
    - что делать дальше 
- если интерпретация не идёт 
    - формально описать полученное 
    - отдохнуть между написанием кода и чтением картинок
    - позвать коллегу посмотреть на картинки вместе 
    - разбить исходную цель на список вопросов/гипотез, ответить по пунктам
    - отрисовать по-другому
- если сигнала не видно
    - побить на (другие) дименшены, детализировать
    - найти/придумать более подходящие метрики 
    - пересмотреть постановку задачи
- если сигнал виден
    - формулировать гипотезы 
        - различать факты, выводы, гипотезы 
        - для краткости можно гипотезы помечать курсивом, уверенные выводы жирным
    - помнить, что корреляция не означает причинно-следственной связи 
        - correlation is not causation 
        - пример: число смертей в водоёмах коррелирует с продажами мороженого 
## Как доносить 
- говорить на понятном языке
- отвечать на волнующие вопросы
- объективная картина (факты)
    - в устной речи: показывать степень подкреплённости каждого утверждения речевыми оборотами
    - в письменной - подкреплять ссылками на данные и расчёты
- субъективная картина (storytelling) 
    - UN - Как рассказывать истории по цифрам http://www.unece.org/fileadmin/DAM/stats/documents/writing/MDM_Part1_English.pdf
- визуализация 
    - Data Visualisation compendium https://github.com/az365/compendium/blob/master/disciplines/datavis.md
