# Metrics

## Intro
- что такое метрика
    - `post` [Мария Ираидина @ Skillbox: Что такое продуктовые метрики и зачем они нужны](https://skillbox.ru/media/management/chto_takoe_produktovye_metriki_i_zachem_oni_nuzhny)
        - Метрика — это качественный или количественный показатель, который отражает ту или иную характеристику и уровень успешности продукта.
- зачем метрики 
    - `compendium` [анализ данных](https://github.com/az365/compendium/blob/master/disciplines/datan.md)
    - `compendium` [управление продуктом](https://github.com/az365/compendium/blob/master/disciplines/prodman.md)
    - `compendium` [качество ML-моделей](https://github.com/az365/compendium/blob/master/disciplines/ds.md)

<a name="classif"></a>
## Классификации метрик 
- из Lean Analytics http://leananalyticsbook.com/
    - qualitative vs quantitative
    - vanity vs actionable (8 vanity m: hits, pageviews, visits, visitors, followers/likes, time on, emails collected, downloads)
    - exploratory vs reporting metrics (the hidded genius of Donald Rumsfeld)
    - accounting (how close you are to an ideal) vs experimental (help to optimize the product, pricing, market)
    - leading vs lagging
    - correlated vs causal
- по способу сопоставления
    - мониторинг и KPI 
        - измеримость
        - достижимость
        - объективность
        - понятный физический смысл
        - понятное влияние на цели компании
        - понятно, как влиять на этот kpi
    - приёмочные (АБТ)
        - красить ухудшения (благодаря монтонности прокрасят и улучшения)
        - не красить контроли (АА-тест)
        - чувствительность (красить лучше других)
        - применимость (некоторые метрики не совместимы с некоторыми типами экспериментов)
    - исследовательские
- стоимость получения vs близость к прикладным целям продукта
    - оффлайн: оценка качества модели (на тест-сетах)
        - оффлайновая метрика строится на модели продукта и пользователя и приближает онлайновую, но считается дешевле и без рисков на живой аудитории
        - см. далее: Метрики качества ML-моделей
    - онлайн: измеримые пользовательские (на АБТ)
        - см. далее: Метрики в АБ-тестинге
    - абстрактные: счастье пользователя (то, что в идеале хотим померить, но не можем)
- по назначению
    - бизнесовые: оцифровка бизнес-модели 
    - аудиторные: MAU, DAU, Core, Churn/Retention, LT, LTV
        - про ретеншены и LifeTime: http://kxk.ru/matriarhat/v1_693889__.php
        - параметры сессионного LT/LTV: timeout, timebound
    - поведенческие: как пользуются продуктом 
        - сессионные (session-based)
        - секвенциальные (CJM-based)
    - оценочные
        - метрики качества продукта
        - метрики качества ML-модели

<a name=""prod"></a><a name="business"></a>
## Продуктовые и бизнесовые метрики
- продуктовые vs бизнесовые (согласно `post` [MaxRokatansky (Otus) @ Habr: Как продакт-менеджеру найти метрику роста и свести Unit-экономику](https://habr.com/ru/company/otus/blog/499298/))
    - Бизнес метрики описывают успешность компании: выручка и средняя выручка с пользователя, прибыль, маржа, объем реализованной продукции.
    - Продуктовые метрики характеризуют поведение пользователей и экономику продукта.
- хорошие и плохие 
    - хорошая метрика (согласно [Lean Analytics](http://leananalyticsbook.com))
        - comparative
        - understandable
        - ratio or rate (ratios are easier to act on, are inherently comparative, are good for comparing factors)
        - changes the way to behave
    - плохая метрика (согласно [Lean Analytics](http://leananalyticsbook.com))
        - vanity, not actionable: hits, pageviews, visits, visitors, followers/likes, time on, emails collected, downloads
- больше о продуктах и продуктовых метриках
    - https://gopractice.ru
    - http://sergeytikhomirov.ru

<a name="frameworks"></a>
### Фреймворки продуктовых метрик
- фреймворк HEART (`pdf` [Google, 2010](https://research.google/pubs/pub36299))
    - Happiness (Счастье)
    - Engagement (Вовлечение)
    - Adoption (Принятие)
    - Retention (Возвращаемость)
    - Task Success (Успех ключевых задач)
- фреймворк AARRR
    - Acquisition - How do users find us?
    - Activation - Do users have a great first experience?
    - Retention - Do users come back?
    - Revenue - How do you make money?
    - Referral - Do users tell others?
- фреймворк PULSAE 
    - PageViews
    - UpTime 
    - Latency
    - SevenDay
    - ActiveUsers
    - Earnings 
- Product Metric Canvas
    - фича
    - на кого влияет (внутри, снаружи)
    - как влияет (внутри, снаружи)
    - как измеряем влияние (внутри, снаружи)
- Метрики по этапам жизненного цикла продукта (согласно [С.Тихомирову: Mobile Product Marketing by Scarlett Johansson](http://sergeytikhomirov.ru/mobile-product-marketing))
    - внедрение нового продукта - выход на рынок
        - installations
        - feedback
        - store rating 
    - первые клиенты - стабилизация аудитории 
        - engagement 
        - retention 
        - conversions
        - DAU 
    - рост базы клиентов - наращивание аудитории 
        - install retention 
        - interactions 
        - user growth 
        - virality 
        - ROI 
    - насыщение рынка - стимулирвоание продаж 
        - sales funnel 
        - MAU 
        - average purchase value 
        - chrurn rate 
        - LTV 
        - CAC 
        - ARPU 
    - спад интереса - смена парадигмы 

<a name="cult"</a>
### Культура работы с метриками
- верифицируемость
    - всегда ссылаться на источник с подробностями 
    - коммитить отчуждаемый код расчёта метрик 
    - формулировать воспроизводимо 
- верифицированность 
    - сбиваться с эталонными расчётами 
    - можем объяснить, что и почему видим 
    - можно умножать/делить на показатели из других каноничных источников
- как визуализировать https://github.com/az365/compendium/blob/master/disciplines/datavis.md
    - рисовать больше одного числа на картинке
    - всегда указывать полное наименование среза и метрики на картинке (аббревиатуры и жаргонизмы можно)
    - аккуратность и стандартизация форматов определяют скорость и однозначность чтения
    - стандартизированные обозаначения (цвета, штриховки, шрифты)
    - растры по-английски 
- как анализировать 
    - выписать, что отображено 
    - выпивать, что тут видно (по факту)
    - гипотезы и трактовки
    - выписывать допущения и ограничения 
- как расследовать 
    - формулировать увиденную аномалию KPI
    - симптомы: локализация до среза, сопутствующие факты со ссылками
    - гипотезы и проверки 
- как доносить/формулировать 
    - показывать степень уверенности (показывается вводными оборотами)
        - фактическое наблюдение (видим, что)
        - доказанный факт (показано, что)
        - сильная гипотеза (кажется, что)
        - авторитетное утверждение (утверждается, что)
        - собственное мнение (на мой взгляд)
        - слабая гипотеза (может быть)
        - фантазия (а вдруг, вот бы)
    - разделять корреляции и причины-следствия
    - убедиться, что правильно поняли 
    - проследить, как использовано (попросить согласовать решение/публикации)

<a name="sys"></a>
### Разработка системы метрик 
- для чего система метрик 
    - разделение зон ответственности
    - мотивация за счёт более прозрачного влияния на KPI 
    - возможность находить узкие места, точки роста компании/сервиса
    - анализ динамики, разложение на влияющие факторы
    - ...
- иерархия метрик
    - принципы
        - нижележащие метрики либо аппроксимируют, либо детализируют вышележащие
        - аппроксимации всегда неточны и в случае метрик эта погрешность неизмерима
        - всегда остаются белые пятна, которые надо заполянть волей и виженом 
    - от структуры метрик к структуре организации
        - каждый человек/подразделение должны знать, какую метрику они растят, и как она влияет на вешележащие по иерархии
    - больше об иерархии метрик 
        - `post` [С.Тихомиров - Иерархия/пирамида метрик](http://sergeytikhomirov.ru/piramida-metrik/)
        - `post` [Мария Ираидина @ Skillbox - Что такое продуктовые метрики и зачем они нужны](https://skillbox.ru/media/management/chto_takoe_produktovye_metriki_i_zachem_oni_nuzhny/#3)
        - `video` [Е.Серёгина @ ProductSense: Ещё одна пирамида метрик (2018)](https://www.youtube.com/watch?v=hgQgr6v39_8)
        - `post` [Е.Серёгина @ Medium: Иеархия vs пирамида метрик (2019)](https://medium.com/@elenest/иерархия-метрик-vs-пирамида-метрик-8eeda61fdefe)
        - `post` [Е.Серёгина @ Medium: когда пирамида метрик поможет/не_поможет (2019)](https://medium.com/@elenest/metrics-frameworks-d7c800f91246)
        - `post` [Гокул Раджарам @ vc.ru: Метрика полярной звезды (2017)](https://vc.ru/flood/26005-north-star-metric)
        - `video` [П.Филонов (Kaspersky) - Связь DS-метрик с бизнес-метриками](https://youtu.be/pDMgvhsUPJM)
    - иерархия vs пирамида метрик
      - пирамида метрик (согласно `post` [MaxRokatansky (Otus) @ Habr: Как продакт-менеджеру найти метрику роста и свести Unit-экономику](https://habr.com/ru/company/otus/blog/499298/))
        - метрика всевластия = метрика полярной звезды
        - [бизнесовые](#business): денежный оборот, доходы, инвестиции, верхнеуровневые аудиторные показатели
        - [продуктовые](#prod): характеристики проблем и решений, пользовательских сценариев (средний чек, частота исползования)
        - интерфейсные: взаимодействие с пользователем в точках контакта (конверсия форм и кнопок)
        - платформенные: доступность и техническая надёжность сервиса
      - пример иерархии метрик
        - прибыль
          - доход
            - количество оплаченных курсов
              - количество партнёров
              - трафик
              - конверсия в заявку, в оплату
            - средний чек, средняя комиссия
          - расход
            - фот
            - маркетинг
      - пример пирамиды метрик
        - бизнесовые метрики
          - общий доход маркетплейса
          - скорость роста пользователей 
        - продуктовые метрики
          - количество продаж в приложении
          - коэффициент конверсии с запуска на покупку 
          - средний чек
        - интерфейсные метрики
          - CES
          - CSI
        - платформенные метрики
          - время отклика сервера
          - количество сбоев и проблем
          - загрузка сервера и использование ресурсов
    - метрика полярной звезды 
        - пример: WatchTime у YouTube 
        - `post` [Гокул Раджарам @ vc.ru: Метрика полярной звезды (2017)](https://vc.ru/flood/26005-north-star-metric)
        - `post` [productlab.ru: Метрики Полярной звезды для растущих технологических компаний](https://productlab.ru/tpost/1xsk70j601-vibor-metriki-polyarnoi-zvezdi-north-sta)
          - Airbnb
            - использование: брони на сутки
            - стратегия: увеличение количества транзакций
          - Airtable
            - деньги: ARR
            - клиентская база: оплаченные рабочие места понедельно
            - стратегия: увеличение количества платящих пользователей
          - Amplitude 
            - деньги: выручка
            - вовлечённость: обучающиеся пользователи понедельно
            - стратегия: увеличение вовлечённости
          - Asana
            - клиентская база: активные платящие пользователи понедельно 
            - стратегия: увеличение количества платящих пользователей 
          - Blue apron
            - деньги: выручка
            - эффективность: средний чек и заказы на клиента 
            - стратегия: улучшение юнит-экономики
          - Calm
            - эффективность: LTV/CAC
            - стратегия: повышение эффективности расходов на привлечение пользователей 
          - Cameo
            - деньги: GMV
            - использование: заказы
            - стратегия: увеличение количества транзакций
          - Casper
            - деньги: выручка
            - эффективность: маржинальный доход
            - стратегия: улучшение юнит-экономики
          - Coda
            - деньги: выручка 
            - вовлечённость: DAU14
            - стратегия: увеличение вовлечённости
          - Coinbase
            - деньги: выручка
            - клиентская база: пользователи с транзакциями помесячно 
            - стратегия: увеличение количества транзакций
          - Dropbox 
            - клиентская база: команды, использующие Dropbox Business
            - стратегия: увеличение количества платящих команд 
          - Duolingo
            - деньги: выручка
            - вовлечённость: DAU
            - пользовательский опыт: пользователи по уровням CEFR
            - стратегия: увеличение активных пользователей и улучшение клиентского опыта 
          - Eventbrite
            - клиентская база: организаторы событий, пользователи, купившие билеты
            - стратегия: увеличение количества транзакций 
          - Facebook 
            - вовлечённость: DAU
            - стратегия: увеличение вовлечённости
          - Figma
            - деньги: выручка
            - клиентская база: доля рынка
            - стратегия: увеличение выручки 
          - GitHub
            - деньги: ARR
            - вовлечённость: MAU
            - стратегия: увеличение вовлечённости
          - Hims
            - деньги: выручка
            - эффективность: маржинальный доход
            - стратегия: улучшение юнит-экономики
          - HubSpot
            - вовлечённость: WAU
            - стратегия: увеличение вовлечённости
          - Instagram 
            - вовлечённость: DAU
            - стратегия: увеличение вовлечённости
          - Jira
            - клиентская база: активные платящие пользователи
            - вовлечённость: MAU
            - стратегия: увеличение вовлечённости пользователей и их конверсия в платящих
          - Loom
            - использование: видео-ролики с просмотрами 
            - стратегия: увеличение шеринга контента 
          - Lyft 
            - использование: поездки 
            - стратегия: увеличение количества транзакций 
          - Miro 
            - использование: доски для совместной работы 
            - стратегия: увеличение шеринга 
          - Netflix 
            - использование: часы просмотра в месяц 
            - стратегия: увеличение глубины вовлечённости 
          - Notion 
            - деньги: выручка 
            - стратегия: увеличение выручки 
          - Patreon
            - деньги: ежемесячный GMV
            - клиентская база: авторы с доходом выше определённой суммы 
            - стратегия: увеличение количества активных авторов
          - Pinterest 
            - деньги: выручка 
            - вовлечённость: WAU 
            - стратегия: увеличение вовлечённости
          - Plaid
            - использование: привязанные банковские счета
            - стратегия: увеличение количества активных пользователей 
          - Robinhood
            - деньги: выручка
            - клиентская база: пользователи, пополнившие депозит
            - пользовательский опыт: NPS
            - стратегия: увеличение количества активных пользователей 
          - Shopify
            - деньги: GMV
            - клиентская база: активные продавцы 
            - стратегия: увеличение количества клиентов и оптимизация расходов на их привлечение 
          - Slack 
            - клиентская база: платящие команды 
            - пользовательский опыт: успешные команды 
            - стратегия: увеличение количества пользователей и улучшение клиентского опыта 
          - SnapChat
            - вовлечение: DAU
            - стратегия: увеличение вовлелённости
          - Spotify 
            - клиентская база: платящие подписчики 
            - использование: часы прослушивания (для подкастов)
            - вовлечённость: MAU
            - стратегия: увеличение вовлечённости пользователей и их конверсии в платящих 
          - Strava
            - вовлечённость: MAU
            - стратегия: увеличение вовлечённости 
          - Substack 
            - деньги: валовый MRR 
            - стратегия: увеличение количества подписок 
          - Superhuman
            - деньги: ARR 
            - пользовательский опыт: уровень восторга + NPS 
            - стратегия: увеличение выручки и улучшение клиентского опыта 
          - Tinder
            - использование: доля платящих пользователей 
            - стратегия: увеличение количества платящих пользователей 
          - Twitch
            - использование: 5-минутные просмотры 
            - стратегия: увеличение количества подписок 
          - Twitter
            - вовлечённость: DAU
            - стратегия: увеличение вовлечённости
          - Uber
            - деньги: валовые списания средств
            - клиентская база: доля рынка
            - использование: поездки
            - стратегия: увеличение количества транзакций и скорости поездок
          - Webflow
            - деньги: ARR
            - клиентская база: платящие подписчики
            - стратегия: увеличение выручки и количества платящих пользователей 
- техническая подложка: согласованность ключевых данных и показателей + стыкуемость инструментов
    - онтология (бизнес-глоссарий)
        - общие понятия в команде 
        - переиспользуемость и сопоставимость расчётов 
        - техническая реализация и применение 
    - кубы (витрины)
    - сетка vs вертикали
    - велосипеды vs компоненты/микросервисы
    - плоские vs сессионные таблицы 
    - материализации vs библиотеки/вьюхи/апи/api 

<a name="analysis"</a> <a name="dynamic"</a> <a name="anomaly"</a> <a name="monitoring"</a>
### Анализ и поддержка метрик
- качество данных, стоимость поддержки, скорость разработки
    - под каждым KPI должен быть куб, позволяющий распилить его на компоненты
    - KPI-метрика должна быть зрелой, чторбы иметь доверие, быть экшенабельной и интерпретабельной
- бизнес/продакшен: мониторинг и расследования
    - аномалия как (бес)полезный сигнал
    - точки измерения
    - цепочки для локализации измерений
    - чеклисты
    - WTF-framework

<a name="abt"></a>
## Мерики в [АБ-тестинге](./datan.md#abt)
- `post` [Я.Академия: Как провести A/B-тестирование: 6 простых шагов](https://academy.yandex.ru/posts/kak-provesti-a-b-testirovanie-6-prostykh-shagov)
    - 1 Определите цели 
    - 2 Определите метрику 
    - 3 Разработайте гипотезу 
    - 4 Подготовьте эксперимент 
    - 5 Проведите эксперимент 
    - 6 Анализируйте результаты
- `post` [TravelPayOuts: Популярные инструменты тестирования веб-страниц](https://blog.travelpayouts.com/split-ab-testing)
    - Google Optimize https://marketingplatform.google.com/about/optimize
    - ABTasty https://www.abtasty.com
    - Optimizely https://www.optimizely.com/
    - ClickMeter https://clickmeter.com
- культура экспериментов 
    - онлайн-метрики
    - оффлайн-метрики 
    - side-by-side aka бок-о-бок
- требования к приёмочным метрикам
    - красить ухудшения (благодаря монотонности прокрасят и улучшения)
    - не красить контроли (АА-тест)
    - чувствительность (красить лучше других)
    - применимость (некоторые метрики не совместимы с некоторыми типами экспериментов)
- валидация метрик
- сложные дизайны экспреиментов 
- особые кейсы
    - [кластера](./ds.md#clustering) в соцсеточках
    - города в ритейле

<a name="ml"></a>
## Метрики качества [Machine Learning](./ds.md) моделей
- для задач классификации (согласно [Queirozf: Evaluation Metrics for Classification Problems. Quick Examples + References](http://queirozf.com/entries/evaluation-metrics-for-classification-quick-examples-references)
    - accuracy
    - precision, recall
    - F1
    - Top-K
    - TPR (чувствительность), FPR, 1-FPR (специфичность)
    - AUC ROC (receiver operating characteristic)
        - Understanding ROC curves http://www.navan.name/roc/
    - LogLoss
    - cohen's kappa = 1 - (1-accuracy / 1-baseline)
    - weighted kappa = 1 - weighted error / weighted baseline error
    - quadratic weighted cappa https://arxiv.org/abs/1509.07107 (implemented in coursera's ipynb)
        - примеры использования
            - Crowd Flower search results relevance
            - Prudential life insurance assessment
            - diabetic retinophaty detection
            - The Hewlett Foundation automated essay scoring
- для задач регрессии
    - MSE, RMSE, R2
    - MAE
    - MSPE, MAPE, SMAPE
    - RMSLE
- для задач ранжирования
    - precision-family
        - p@K
        - ap@K
        - map@K - mean average precision
    - nDCG-family
        - CG@K
        - DCG@K
        - nDCG@K - normalized discounted cumulative gain
    - MRR - mean reciprocal rank
    - ранговые коэффициенты коррелляции
        - кендэлла
        - спирмена
    - каскадная модель поведения
        - err - expected reciprocal rank
        - pfound
    - read more
        - Метрики качества ранжирования https://habr.com/ru/company/econtenta/blog/303458/
        - Learning to Rank using Gradient Descent -- original paper about pairwise method for AUC optimization http://icml.cc/2015/wp-content/uploads/2015/06/icml_ranking.pdf
        - Overview of further developments of RankNet https://www.microsoft.com/en-us/research/wp-content/uploads/2016/02/MSR-TR-2010-82.pdf
        - RankLib (implemtations for the 2 papers from above) https://sourceforge.net/p/lemur/wiki/RankLib/
        - Learning to Rank Overview https://wellecks.wordpress.com/2015/01/15/learning-to-rank-overview
- для [задач кластеризации](./ds.md#clustering)
    - Evaluation metrics for clustering http://nlp.uned.es/docs/amigo2007a.pdf
        - formal constraints
            - cluster homogenity
            - cluster completness
            - rag bag (introducing disorder into a disordered cluster is less harmful than introducing disorder into a clean cluster)
            - size vs quantity
        - comparison of evaluation metrics
            - Evaluation by set matching
            - Metrics based on Counting Pairs
            - Metrics based on entropy
            - Evaluation metrics based on edit distance
            - BCubed: a mixed family of metrics
- связь метрик DS и бизнеса 
    - П.Филонов (Kaspersky) - Связь DS-метрик с бизнес-метриками https://youtu.be/pDMgvhsUPJM
    - А.Дьяконов - Кривые в машинном обучении https://dyakonov.org/2019/08/29/кривые-в-машинном-обучении/
